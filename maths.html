<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸æ„Ÿå‹‡è€…ï¼šåŸå ¡å¤§é€²æ“Š</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f1c40f;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        .game-container {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 600px; /*ç¨å¾®åŠ é«˜ä»¥å®¹ç´åœ°åœ–*/
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hidden {
            display: none !important;
        }

        /* --- New Feature: Progress Map --- */
        .map-area {
            margin-bottom: 20px;
            padding: 10px 0;
            position: relative;
            height: 60px;
            display: flex;
            align-items: center;
        }

        .track-bg {
            width: 100%;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 10px;
            position: relative;
            z-index: 1;
        }

        .track-fill {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .hero-marker {
            position: absolute;
            font-size: 35px;
            top: -15px; /* è®“å‹‡è€…ç«™åœ¨ç·šä¸Š */
            left: 0%;
            transform: translateX(-10px); /* ä¿®æ­£ä¸­å¿ƒé» */
            transition: left 0.5s ease;
            z-index: 2;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }

        .castle-marker {
            position: absolute;
            font-size: 40px;
            right: 0;
            top: -20px;
            z-index: 2;
        }
        /* -------------------------------- */

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #eef2f7;
            border-radius: 15px;
            font-size: 1.1rem;
        }

        .hearts { color: var(--danger-color); }
        .score-text { font-weight: bold; color: #555; }

        .monster-stage {
            height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
        }

        .monster-emoji {
            font-size: 80px;
            transition: transform 0.2s;
        }

        .monster-name {
            font-weight: bold;
            color: #666;
            margin-top: 5px;
        }

        .hit-effect {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: var(--danger-color);
            opacity: 0;
            top: 0;
            pointer-events: none;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.6;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px dashed #d1d8e0;
        }

        .highlight {
            color: var(--danger-color);
            font-weight: 900;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            width: 100%;
        }

        .option-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.3rem;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 0 #357abd;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Start & End Screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .start-btn, .restart-btn {
            background-color: var(--success-color);
            color: white;
            font-size: 1.5rem;
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 0 #27ae60;
            animation: pulse 2s infinite;
        }

        /* Modal/Feedback */
        .modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            border-radius: 20px;
        }

        .modal-content {
            background: white;
            width: 85%;
            max-width: 400px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            animation: popIn 0.3s;
        }

        .feedback-title { font-size: 1.5rem; margin-bottom: 10px; }
        .feedback-text {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 20px;
            text-align: left;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
        }

        .next-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 30px;
            border-radius: 20px;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #357abd;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes monsterHit { 0% { transform: scale(1); } 50% { transform: scale(0.8) rotate(10deg); filter: grayscale(100%); } 100% { transform: scale(1); } }

        .shake-anim { animation: shake 0.5s; }
        .hit-anim { animation: monsterHit 0.4s; }

    </style>
</head>
<body>

<div class="game-container">
    
    <!-- Game Area -->
    <div id="game-screen">
        <div class="header">
            <div class="hearts" id="hearts-display">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
            <div class="score-text">é—œå¡: <span id="level-display">1/20</span></div>
        </div>

        <!-- NEW: Progress Map -->
        <div class="map-area">
            <div class="track-bg">
                <div class="track-fill" id="track-fill"></div>
            </div>
            <div class="hero-marker" id="hero-marker">ğŸ¤º</div>
            <div class="castle-marker">ğŸ°</div>
        </div>

        <div class="monster-stage">
            <div class="hit-effect" id="hit-msg">-1 HP</div>
            <div class="monster-emoji" id="monster-emoji">ğŸ‘¾</div>
            <div class="monster-name" id="monster-name">å²èŠå§†</div>
        </div>

        <div class="question-box" id="question-text">
            é¡Œç›®è¼‰å…¥ä¸­...
        </div>

        <div class="options-grid" id="options-container">
            <!-- Buttons generated by JS -->
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen">
        <h1>æ•¸æ„Ÿå‹‡è€…<br>åŸå ¡å¤§é€²æ“Š</h1>
        <p style="margin: 20px; color: #666;">æ‰“æ•— 20 éš»æ“‹è·¯çš„æ€ªç¸<br>ä¸€æ­¥æ­¥èµ°å‘åŸå ¡ï¼</p>
        <div style="font-size: 3rem;">ğŸ°ğŸƒğŸ’¨</div>
        <button class="start-btn" onclick="startGame()">å‡ºç™¼å†’éšª</button>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="screen hidden">
        <h1 id="end-title">éŠæˆ²çµæŸ</h1>
        <div id="end-emoji" style="font-size: 4rem; margin: 20px;">ğŸ†</div>
        <p id="end-msg" style="font-size: 1.2rem; padding: 0 20px;">ä½ æŠµé”åŸå ¡äº†ï¼</p>
        <p>æœ€çµ‚åˆ†æ•¸: <span id="final-score">0</span>/20</p>
        <button class="restart-btn" onclick="startGame()">å†æ¬¡æŒ‘æˆ°</button>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal hidden">
        <div class="modal-content">
            <div class="feedback-title" id="fb-title"></div>
            <div class="feedback-text" id="fb-text"></div>
            <button class="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é—œ â”</button>
        </div>
    </div>

</div>

<script>
    const questions = [
        // ç¬¬ä¸€é—œï¼šé—œéµå­—æ··æ·†
        {
            q: "ç›¤å­è£¡æœ‰ 8 é¡†è‰è“ï¼Œå¼Ÿå¼Ÿåƒæ‰äº† 3 é¡†ï¼Œè«‹å•ç›¤å­è£¡<span class='highlight'>å‰©ä¸‹</span>å¹¾é¡†è‰è“ï¼Ÿ",
            options: [5, 11, 3],
            ans: 0,
            monster: "ğŸŸ¢ è²ªåƒå²èŠå§†",
            tip: "çœ‹åˆ°ã€Œåƒæ‰ã€å’Œã€Œå‰©ä¸‹ã€ï¼Œæ‡‰è©²æ˜¯ç”¨æ¸›æ³• (8 - 3) å–”ï¼"
        },
        {
            q: "å°æ˜æœ‰ 6 æé‰›ç­†ï¼Œå°è¯ä¹Ÿæœ‰ 6 æé‰›ç­†ï¼Œè«‹å•ä»–å€‘<span class='highlight'>ä¸€å…±æœ‰</span>å¹¾æé‰›ç­†ï¼Ÿ",
            options: [0, 6, 12],
            ans: 2,
            monster: "ğŸ‘¯ é›™èƒèƒç²¾éˆ",
            tip: "ã€Œä¸€å…±ã€å°±æ˜¯æŠŠå…©å€‹äººçš„åŠ èµ·ä¾† (6 + 6)ï¼"
        },
        {
            q: "ç´…è‰²æ°£çƒæœ‰ 10 å€‹ï¼Œè—è‰²æ°£çƒæœ‰ 4 å€‹ï¼Œè«‹å•ç´…è‰²æ°£çƒæ¯”è—è‰²æ°£çƒ<span class='highlight'>å¤šå¹¾å€‹</span>ï¼Ÿ",
            options: [14, 6, 4],
            ans: 1,
            monster: "ğŸˆ æ°£çƒå¹½éˆ",
            tip: "æ¯”è¼ƒèª°æ¯”è¼ƒå¤šï¼Œè¦ç”¨æ¸›æ³•ç®—å·®è· (10 - 4)ï¼"
        },
        {
            q: "å†°ç®±è£¡æœ‰ 7 ç½ç‰›å¥¶ï¼Œåª½åª½<span class='highlight'>åˆè²·å›ä¾†</span> 5 ç½ï¼Œç¾åœ¨å†°ç®±è£¡æœ‰å¹¾ç½ç‰›å¥¶ï¼Ÿ",
            options: [2, 12, 7],
            ans: 1,
            monster: "ğŸ® ç‰›å¥¶å·¨æ€ª",
            tip: "ã€Œåˆè²·å›ä¾†ã€æ˜¯è®Šå¤šäº†ï¼Œè¦ç”¨åŠ æ³• (7 + 5) å–”ï¼"
        },
        
        // ç¬¬äºŒé—œï¼šå¤šé¤˜æ•¸å­—é™·é˜±
        {
            q: "æ± å¡˜è£¡æœ‰ 5 éš»é´¨å­ï¼Œ3 éš»é’è›™ï¼Œå²¸é‚Šé‚„æœ‰ <span class='highlight'>2 æ£µæ¨¹</span>ã€‚è«‹å•æ± å¡˜è£¡å…±æœ‰å¹¾éš»<span class='highlight'>å‹•ç‰©</span>ï¼Ÿ",
            options: [10, 8, 5],
            ans: 1,
            monster: "ğŸŒ³ å½è£æ¨¹å¦–",
            tip: "å°å¿ƒï¼ã€Œæ¨¹ã€ä¸æ˜¯å‹•ç‰©ï¼Œä¸è¦åŠ é€²å»ã€‚åªè¦ç®—é´¨å­å’Œé’è›™ (5 + 3)ï¼"
        },
        {
            q: "å…¬è»Šä¸ŠåŸæœ¬æœ‰ 10 å€‹äººï¼Œåˆ°äº†è»Šç«™ä¸‹è»Š 3 äººï¼Œå…¬è»Šç·¨è™Ÿæ˜¯ <span class='highlight'>202 è™Ÿ</span>ã€‚è«‹å•ç¾åœ¨è»Šä¸Šæœ‰å¹¾å€‹äººï¼Ÿ",
            options: [7, 205, 13],
            ans: 0,
            monster: "ğŸšŒ å·´å£«æ€ªå®¢",
            tip: "å…¬è»Šè™Ÿç¢¼ 202 æ˜¯åå­—ï¼Œä¸èƒ½æ‹¿ä¾†ç®—ï¼åªè¦ç®—äººæ•¸ (10 - 3)ã€‚"
        },
        {
            q: "å°èŠ±ä»Šå¹´ <span class='highlight'>8 æ­²</span>ï¼Œå¥¹é¤Šäº†ä¸€éš» 2 æ­²çš„è²“å’Œä¸€éš» 3 æ­²çš„ç‹—ã€‚è«‹å•<span class='highlight'>è²“å’Œç‹—</span>ä¸€å…±å¹¾æ­²ï¼Ÿ",
            options: [13, 5, 8],
            ans: 1,
            monster: "ğŸ¶ å¯µç‰©å¤§å¸«",
            tip: "é¡Œç›®åªå•ã€Œè²“å’Œç‹—ã€ï¼Œå°èŠ±çš„ 8 æ­²æ˜¯å¤šé¤˜çš„æ•¸å­—å–”ï¼"
        },
        {
            q: "æ¡Œä¸Šæœ‰ 9 å¡Šé¤…ä¹¾ï¼Œå°ç‹—å·åƒäº† 2 å¡Šï¼Œç¾åœ¨æ˜¯<span class='highlight'>ä¸‹åˆ 3 é»</span>ã€‚è«‹å•é‚„å‰©ä¸‹å¹¾å¡Šé¤…ä¹¾ï¼Ÿ",
            options: [4, 10, 7],
            ans: 2,
            monster: "â° æ™‚é–“å°å·",
            tip: "æ™‚é–“ã€Œ3é»ã€è·Ÿé¤…ä¹¾æ•¸é‡æ²’é—œä¿‚ï¼Œä¸è¦è¢«é¨™äº†ï¼(9 - 2)ã€‚"
        },

        // ç¬¬ä¸‰é—œï¼šèªæ„é‚è¼¯
        {
            q: "å“¥å“¥æœ‰ 8 é¡†ç³–æœï¼Œ<span class='highlight'>å¼Ÿå¼Ÿæ¯”å“¥å“¥å°‘ 3 é¡†</span>ã€‚è«‹å•<span class='highlight'>å¼Ÿå¼Ÿ</span>æœ‰å¹¾é¡†ç³–æœï¼Ÿ",
            options: [11, 5, 3],
            ans: 1,
            monster: "ğŸ­ ç³–æœæƒ¡é­”",
            tip: "å¼Ÿå¼Ÿæ¯”è¼ƒå°‘ï¼Œæ‰€ä»¥è¦ç”¨å“¥å“¥çš„ç³–æœå»æ¸› (8 - 3)ã€‚"
        },
        {
            q: "æ’éšŠè²·ç¥¨ï¼Œå°æ˜å‰é¢æœ‰ 4 å€‹äººï¼Œå¾Œé¢æœ‰ 2 å€‹äººã€‚è«‹å•é€™ä¸€æ’<span class='highlight'>ä¸åŒ…å«å°æ˜</span>å…±æœ‰å¹¾å€‹äººï¼Ÿ",
            options: [6, 7, 4],
            ans: 0,
            monster: "ğŸš¶ æ’éšŠæ®­å±",
            tip: "é¡Œç›®èªªã€Œä¸åŒ…å«å°æ˜ã€ï¼Œæ‰€ä»¥åªè¦ç®—å‰é¢åŠ å¾Œé¢ (4 + 2)ã€‚"
        },
        {
            q: "ç›’å­è£¡æœ‰ 5 é¡†ç´…çƒï¼Œ<span class='highlight'>ç¶ çƒæ¯”ç´…çƒå¤š 2 é¡†</span>ã€‚è«‹å•<span class='highlight'>ç¶ çƒ</span>æœ‰å¹¾é¡†ï¼Ÿ",
            options: [7, 3, 2],
            ans: 0,
            monster: "ğŸ¾ å½ˆè·³æ€ªçƒ",
            tip: "ç¶ çƒæ¯”è¼ƒå¤šï¼Œæ‰€ä»¥è¦ç”¨ç´…çƒåŠ  2 (5 + 2)ã€‚"
        },
        {
            q: "å°è¯æœ‰ 10 å…ƒï¼Œè²·é‰›ç­†èŠ±äº† 7 å…ƒï¼Œåª½åª½<span class='highlight'>åˆçµ¦ä»–</span> 5 å…ƒã€‚è«‹å•ä»–ç¾åœ¨å£è¢‹è£¡æœ‰å¤šå°‘éŒ¢ï¼Ÿ",
            options: [3, 8, 12],
            ans: 1,
            monster: "ğŸ’° éŒ¢åŒ…å¦–ç²¾",
            tip: "è¦ä¸€æ­¥ä¸€æ­¥ç®—ï¼šå…ˆèŠ±éŒ¢ (10-7=3)ï¼Œå†æ‹¿åˆ°éŒ¢ (3+5=8)ã€‚"
        },

        // ç¬¬å››é—œï¼šé»æ•¸èˆ‡è¦–è¦º
        {
            q: "åœ–ä¸Šæœ‰ï¼šâšªâšªâšªâšª âš«âš«âš«<br>è«‹å•ç™½çƒå’Œé»‘çƒ<span class='highlight'>ç›¸å·®</span>å¹¾é¡†ï¼Ÿ",
            options: [7, 4, 1],
            ans: 2,
            monster: "ğŸ‘ï¸ ç¨çœ¼å·¨äºº",
            tip: "ç™½çƒ4å€‹ï¼Œé»‘çƒ3å€‹ï¼Œç›¸å·®å°±æ˜¯æ¸›æ³• (4 - 3)ã€‚"
        },
        {
            q: "å°æ˜å¾ç¬¬ 1 é è®€åˆ°ç¬¬ 5 é ï¼Œè«‹å•ä»–ä¸€å…±è®€äº†å¹¾é ï¼Ÿ<br>(ä¼¸å‡ºæ‰‹æŒ‡é ­æ•¸æ•¸çœ‹)",
            options: [4, 5, 6],
            ans: 1,
            monster: "ğŸ“š æ›¸æœ¬æ€ªç¸",
            tip: "ç”¨æ‰‹æŒ‡æ•¸ï¼š1ã€2ã€3ã€4ã€5ï¼Œç¸½å…±æœ‰ 5 é å–”ï¼ç›´æ¥æ¸›æœƒå°‘ç®—ä¸€é ã€‚"
        },
        {
            q: "æ’éšŠéšŠä¼ä¸­ï¼Œå°ç¾æ’åœ¨ç¬¬ 3 å€‹ï¼Œå°å¼·æ’åœ¨ç¬¬ 7 å€‹ã€‚è«‹å•ä»–å€‘<span class='highlight'>ä¸­é–“</span>éš”äº†å¹¾å€‹äººï¼Ÿ",
            options: [3, 4, 5],
            ans: 0,
            monster: "ğŸš§ é˜»æ“‹æ€ª",
            tip: "ä»–å€‘ä¸­é–“æ˜¯ï¼šç¬¬4ã€ç¬¬5ã€ç¬¬6å€‹ï¼Œæ‰€ä»¥æ˜¯ 3 å€‹äººã€‚"
        },
        {
            q: "æ¨¹ä¸Šæœ‰ 5 éš»é³¥ï¼Œ3 éš»é³¥åœ¨é£›ã€‚<span class='highlight'>åœ°ä¸Š</span>æœ‰å¹¾éš»é³¥ï¼Ÿ",
            options: [8, 2, 0],
            ans: 2,
            monster: "ğŸ¦… é£›å¤©é·¹",
            tip: "é¡Œç›®å•åœ°ä¸Šï¼Œä½†é³¥éƒ½åœ¨æ¨¹ä¸Šæˆ–å¤©ä¸Šï¼Œæ‰€ä»¥åœ°ä¸Šæ˜¯ 0 éš»ï¼"
        },

        // ç¬¬äº”é—œï¼šå¤§é­”ç‹ç¶œåˆé¡Œ
        {
            q: "åª½åª½æº–å‚™äº† 9 ç‰‡èŠå£«å’Œ 3 å¡Šé¤…ä¹¾ï¼Œè«‹å•<span class='highlight'>èŠå£«æ¯”é¤…ä¹¾</span>å¤šå¹¾å€‹ï¼Ÿ",
            options: [12, 6, 9],
            ans: 1,
            monster: "ğŸ§€ èŠå£«é­”ç‹",
            tip: "é€™æ˜¯åœ¨æ¯”è¼ƒæ•¸é‡ï¼Œä¸æ˜¯ç®—ç¸½æ•¸å–”ï¼è¦ç”¨æ¸›æ³• (9 - 3)ã€‚"
        },
        {
            q: "åœè»Šå ´æœ‰ 10 è¼›è»Šï¼Œé–‹èµ°äº† 4 è¼›ï¼Œåˆé–‹èµ°äº† 2 è¼›ã€‚è«‹å•åœè»Šå ´<span class='highlight'>ä¸€å…±å°‘äº†</span>å¹¾è¼›è»Šï¼Ÿ",
            options: [4, 6, 8],
            ans: 1,
            monster: "ğŸš— å»¢æ°£é¾",
            tip: "é¡Œç›®å•ã€Œå°‘äº†å¹¾è¼›ã€ï¼Œæ‰€ä»¥è¦æŠŠå…©æ¬¡é–‹èµ°çš„åŠ èµ·ä¾† (4 + 2)ã€‚"
        },
        {
            q: "ä¸€ç›’é›è›‹æœ‰ 10 é¡†ï¼Œç…®äº† 3 é¡†ï¼Œ<span class='highlight'>æ‰“ç ´äº† 1 é¡†</span>ã€‚è«‹å•é‚„<span class='highlight'>å‰©ä¸‹</span>å¹¾é¡†å®Œæ•´çš„ï¼Ÿ",
            options: [7, 6, 8],
            ans: 1,
            monster: "ğŸ¥š æ—è›‹è›‹",
            tip: "ç…®æ‰è¦æ¸›ï¼Œæ‰“ç ´ä¹Ÿè¦æ¸›å–”ï¼(10 - 3 - 1)ã€‚"
        },
        {
            q: "ã€çµ‚æ¥µBOSSã€‘<br>æ©¡çš®æ“¦ 5 å…ƒï¼Œå°º 15 å…ƒã€‚å°æ˜æœ‰ 10 å…ƒæƒ³è²·å°ºï¼Œè«‹å•ä»–<span class='highlight'>é‚„ä¸å¤ </span>å¤šå°‘éŒ¢ï¼Ÿ",
            options: [5, 25, 10],
            ans: 0,
            monster: "ğŸ‰ æ•¸å­¸æƒ¡é¾",
            tip: "å°ºè¦15å…ƒï¼Œä»–åªæœ‰10å…ƒã€‚å·®è·æ˜¯ (15 - 10) = 5å…ƒã€‚"
        }
    ];

    let currentQ = 0;
    let hp = 5;
    let score = 0;

    window.onload = function() {
        document.getElementById('feedback-modal').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        document.getElementById('start-screen').classList.remove('hidden');
    };

    function startGame() {
        currentQ = 0;
        hp = 5;
        score = 0;
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        document.getElementById('feedback-modal').classList.add('hidden');
        updateStats();
        updateMap();
        loadQuestion();
    }

    // æ›´æ–°åœ°åœ–å‹‡è€…ä½ç½®
    function updateMap() {
        const total = questions.length;
        // è¨ˆç®—ç™¾åˆ†æ¯”ï¼Œæœ€å¤§ä¸è¶…é 92% (é ç•™ç©ºé–“çµ¦åŸå ¡)
        const percentage = Math.min((currentQ / total) * 100, 92);
        
        document.getElementById('track-fill').style.width = percentage + "%";
        document.getElementById('hero-marker').style.left = percentage + "%";
    }

    function updateStats() {
        let heartStr = "";
        for(let i=0; i<hp; i++) heartStr += "â¤ï¸";
        for(let i=hp; i<5; i++) heartStr += "ğŸ–¤";
        document.getElementById('hearts-display').innerText = heartStr;
        document.getElementById('level-display').innerText = (currentQ + 1) + "/20";
        updateMap(); // æ¯æ¬¡æ›´æ–°æ•¸æ“šåŒæ™‚ç§»å‹•å‹‡è€…
    }

    function loadQuestion() {
        if (currentQ >= questions.length) {
            endGame();
            return;
        }

        const q = questions[currentQ];
        document.getElementById('question-text').innerHTML = q.q;
        
        const monsterEmoji = q.monster.split(' ')[0];
        const monsterName = q.monster.split(' ')[1];
        document.getElementById('monster-emoji').innerText = monsterEmoji;
        document.getElementById('monster-name').innerText = monsterName;
        document.getElementById('monster-emoji').classList.remove('hit-anim');

        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index);
            container.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex) {
        const q = questions[currentQ];
        const modal = document.getElementById('feedback-modal');
        const title = document.getElementById('fb-title');
        const text = document.getElementById('fb-text');

        if (selectedIndex === q.ans) {
            score++;
            document.getElementById('monster-emoji').classList.add('hit-anim');
            playSuccessEffect(selectedIndex);
        } else {
            hp--;
            updateStats();
            document.querySelector('.game-container').classList.add('shake-anim');
            setTimeout(() => document.querySelector('.game-container').classList.remove('shake-anim'), 500);

            if (hp <= 0) {
                title.innerText = "ğŸ’” è¢«æ€ªç¸æ”»æ“Šäº†ï¼";
                title.style.color = "var(--danger-color)";
                text.innerHTML = `æ­£ç¢ºç­”æ¡ˆæ˜¯ <b>${q.options[q.ans]}</b>ã€‚<br><br>ğŸ’¡ å°å¸«æç¤ºï¼š<br>${q.tip}<br><br>(ç”Ÿå‘½å€¼æ­¸é›¶ï¼ŒéŠæˆ²çµæŸ)`;
                modal.classList.remove('hidden');
            } else {
                title.innerText = "ğŸ’¥ å“å‘€ï¼Œå—å‚·äº†ï¼";
                title.style.color = "var(--danger-color)";
                text.innerHTML = `æ­£ç¢ºç­”æ¡ˆæ˜¯ <b>${q.options[q.ans]}</b>ã€‚<br><br>ğŸ’¡ å°å¸«æç¤ºï¼š<br>${q.tip}`;
                modal.classList.remove('hidden');
            }
        }
    }

    function playSuccessEffect(index) {
        const buttons = document.querySelectorAll('.option-btn');
        buttons[index].style.backgroundColor = "#2ecc71";
        buttons[index].style.boxShadow = "0 4px 0 #27ae60";
        
        setTimeout(() => {
            currentQ++;
            updateStats(); // é€™è£¡æ›´æ–° stats æœƒè§¸ç™¼ updateMapï¼Œå‹‡è€…ç§»å‹•
            loadQuestion();
        }, 800);
    }

    function nextQuestion() {
        document.getElementById('feedback-modal').classList.add('hidden');
        if (hp <= 0) {
            endGame();
        } else {
            currentQ++;
            updateStats(); // é€™è£¡ä¹Ÿæœƒè§¸ç™¼å‹‡è€…ç§»å‹•
            loadQuestion();
        }
    }

    function endGame() {
        const endScreen = document.getElementById('end-screen');
        const endTitle = document.getElementById('end-title');
        const endMsg = document.getElementById('end-msg');
        const endEmoji = document.getElementById('end-emoji');
        
        document.getElementById('game-screen').style.display = 'block'; 
        endScreen.classList.remove('hidden');
        document.getElementById('final-score').innerText = score;

        // ç¢ºä¿å‹‡è€…æœ€å¾Œåˆ°é”çµ‚é»
        document.getElementById('track-fill').style.width = "92%";
        document.getElementById('hero-marker').style.left = "92%";

        if (hp > 0 && score >= 15) {
            endTitle.innerText = "ğŸ‰ ä»»å‹™æˆåŠŸï¼";
            endMsg.innerText = "å¤ªå²å®³äº†ï¼å‹‡è€…æˆåŠŸé€²å…¥åŸå ¡ï¼";
            endEmoji.innerText = "ğŸ°âœ¨";
        } else if (hp > 0) {
            endTitle.innerText = "âœ¨ å†’éšªå®Œæˆ";
            endMsg.innerText = "é›–ç„¶åˆ°äº†åŸå ¡ï¼Œä½†å¯ä»¥åšå¾—æ›´å¥½å–”ï¼";
            endEmoji.innerText = "ğŸ›¡ï¸";
        } else {
            endTitle.innerText = "ğŸ’€ ä»»å‹™å¤±æ•—";
            endMsg.innerText = "å‹‡è€…å€’åœ¨åŠè·¯ä¸Šäº†... è«‹å†è©¦ä¸€æ¬¡ï¼";
            endEmoji.innerText = "ğŸ‘»";
        }
    }

</script>

</body>
</html>